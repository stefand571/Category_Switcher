name: Release Category_Switcher

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      # -------------------------------
      # 1️⃣ Category_Switcher.zip (EXE + Resources + Version + Settings)
      # -------------------------------
      - name: Pack Category_Switcher.zip
        shell: pwsh
        run: |
          $tempDir = "ReleasePackage"
          New-Item -ItemType Directory -Path $tempDir

          Copy-Item -Recurse -Force "Release EXE" "$tempDir\Release EXE"
          Copy-Item -Recurse -Force "Resources" "$tempDir\Resources"
          Copy-Item -Force "Version.json","settings.xaml" "$tempDir"

          Compress-Archive -Path "$tempDir\*" -DestinationPath "Category_Switcher.zip" -Force

          Remove-Item -Recurse -Force $tempDir

      # -------------------------------
      # 2️⃣ Category_Switcher Source.zip (alles außer Release EXE, .git, .github)
      # -------------------------------
      - name: Pack Category_Switcher Source.zip
        shell: pwsh
        run: |
          $tempDir = "SourcePackage"
          New-Item -ItemType Directory -Path $tempDir

          $exclude = @("Release EXE",".git",".github","*.zip")
          Get-ChildItem -Recurse -Force | Where-Object { $exclude -notcontains $_.Name } | ForEach-Object {
              $dest = Join-Path $tempDir $_.FullName.Substring((Get-Location).Path.Length + 1)
              if($_.PSIsContainer){ New-Item -ItemType Directory -Path $dest -Force } else { Copy-Item $_.FullName $dest -Force }
          }

          Compress-Archive -Path "$tempDir\*" -DestinationPath "Category_Switcher Source.zip" -Force

          Remove-Item -Recurse -Force $tempDir

      # -------------------------------
      # 3️⃣ GitHub Release erstellen
      # -------------------------------
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            Category_Switcher.zip
            Category_Switcher Source.zip
